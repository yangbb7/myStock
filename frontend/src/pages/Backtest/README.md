# 回测分析页面 (Backtest Analysis Page)

## 概述

回测分析页面是myQuant量化交易系统前端的核心功能模块之一，提供完整的策略回测、结果分析、策略对比和模拟交易功能。该模块支持用户通过历史数据验证策略有效性，进行多策略对比分析，并通过模拟交易环境进行实时策略验证。

## 功能特性

### 1. 回测配置 (BacktestConfigForm)
- **策略选择**: 支持从已配置策略中选择进行回测
- **股票代码选择**: 多选股票代码，支持搜索和筛选
- **时间范围设置**: 灵活的日期范围选择，支持历史数据回测
- **资金设置**: 初始资金、手续费率、滑点率等参数配置
- **策略参数**: 支持JSON格式的自定义策略参数
- **配置管理**: 支持保存和加载常用配置
- **实时状态**: 回测任务状态监控和进度显示

### 2. 回测结果展示 (BacktestResults)
- **绩效概览**: 总收益率、年化收益率、夏普比率、最大回撤等关键指标
- **图表分析**: 资金曲线图、回撤曲线图等可视化展示
- **交易记录**: 详细的交易记录表格，支持排序和筛选
- **详细指标**: 收益指标、风险指标、交易统计、盈亏分析
- **报告导出**: 支持PDF和Excel格式的报告导出
- **结果分享**: 一键复制回测结果摘要

### 3. 策略对比分析 (StrategyComparison)
- **多策略对比**: 支持多个策略的并行对比分析
- **指标排名**: 按不同指标对策略进行排名
- **可视化对比**: 柱状图和折线图展示策略差异
- **收藏功能**: 支持收藏常用策略
- **策略组合**: 创建多策略组合，设置权重分配
- **优化建议**: 基于对比结果提供策略优化建议

### 4. 模拟交易 (SimulationTrading)
- **实时模拟**: 基于实时市场数据的模拟交易环境
- **虚拟资金**: 可配置的虚拟资金和风险等级
- **自动交易**: 支持自动和手动交易模式
- **实时监控**: 资金曲线、持仓状态、交易记录实时更新
- **学习建议**: 基于交易表现提供智能学习建议
- **风险控制**: 最大持仓数、止损止盈等风险管理功能

## 技术实现

### 组件架构
```
BacktestPage (主页面)
├── BacktestConfigForm (回测配置)
├── BacktestResults (结果展示)
├── StrategyComparison (策略对比)
└── SimulationTrading (模拟交易)
```

### 核心依赖
- **React 18+**: 现代化React框架
- **Ant Design 5+**: UI组件库
- **ECharts**: 图表可视化
- **React Query**: 数据状态管理
- **WebSocket**: 实时数据通信
- **Day.js**: 日期处理

### API集成
- `api.analytics.runBacktest()`: 运行回测
- `api.analytics.getBacktestHistory()`: 获取回测历史
- `api.strategy.getStrategies()`: 获取策略列表
- `api.data.getSymbols()`: 获取股票代码
- `api.analytics.exportData()`: 导出数据

### 状态管理
- **本地状态**: 使用React useState管理组件内部状态
- **服务端状态**: 使用React Query管理API数据
- **实时数据**: 使用WebSocket接收实时市场数据

## 使用指南

### 1. 配置回测
1. 选择要回测的策略
2. 设置股票代码和时间范围
3. 配置初始资金和交易参数
4. 可选择保存配置以便重用
5. 点击"开始回测"启动任务

### 2. 查看结果
1. 回测完成后自动跳转到结果页面
2. 查看绩效概览和关键指标
3. 分析图表和交易记录
4. 导出详细报告或分享结果

### 3. 策略对比
1. 选择要对比的多个策略
2. 选择对比指标进行排序
3. 查看可视化对比图表
4. 创建策略组合并设置权重

### 4. 模拟交易
1. 配置模拟交易参数
2. 选择策略和股票代码
3. 启动模拟交易环境
4. 实时监控交易表现
5. 查看学习建议和优化提示

## 性能优化

### 1. 数据处理
- 使用React.memo优化组件渲染
- 实现虚拟滚动处理大量数据
- 使用useMemo缓存计算结果

### 2. 图表优化
- ECharts懒加载和按需渲染
- 数据点限制和采样优化
- 图表主题和配置缓存

### 3. 网络优化
- React Query缓存和重试机制
- WebSocket连接管理和重连
- 分页和增量加载

## 扩展功能

### 1. 高级分析
- 风险归因分析
- 因子暴露分析
- 相关性分析
- 压力测试

### 2. 策略优化
- 参数优化算法
- 遗传算法优化
- 网格搜索优化
- 贝叶斯优化

### 3. 报告增强
- 自定义报告模板
- 定时报告生成
- 邮件报告发送
- 报告订阅功能

## 注意事项

### 1. 数据质量
- 确保历史数据的完整性和准确性
- 处理数据缺失和异常值
- 考虑股票分红、拆股等调整

### 2. 回测偏差
- 避免前视偏差
- 考虑交易成本和滑点
- 注意幸存者偏差

### 3. 性能考虑
- 大量数据处理时的内存管理
- 长时间回测的用户体验
- 并发回测任务的资源控制

## 开发规范

### 1. 代码规范
- 使用TypeScript严格类型检查
- 遵循ESLint和Prettier规范
- 组件和函数命名清晰明确

### 2. 测试覆盖
- 单元测试覆盖核心逻辑
- 集成测试验证API交互
- E2E测试确保用户流程

### 3. 文档维护
- 及时更新API文档
- 维护组件使用说明
- 记录重要设计决策

## 版本历史

- **v1.0.0**: 基础回测功能实现
- **v1.1.0**: 添加策略对比功能
- **v1.2.0**: 实现模拟交易功能
- **v1.3.0**: 优化性能和用户体验

## 贡献指南

1. Fork项目仓库
2. 创建功能分支
3. 提交代码变更
4. 创建Pull Request
5. 代码审查和合并

## 许可证

本项目采用MIT许可证，详见LICENSE文件。